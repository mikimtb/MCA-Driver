CCS PCH C Compiler, Version 5.045, 5967               21-Nov-15 21:46

               Filename:   F:\Dropbox (Personal)\Doktorat\GitRepository\MCA Driver\MCA-REVC.X\build\default\debug\main.lst

               ROM used:   552 bytes (4%)
                           Largest free fragment is 14996
               RAM used:   62 (8%) at main() level
                           68 (9%) worst case
               Stack used: 1 locations (0 in main + 1 for interrupts)
               Stack size: 30

*
0000:  GOTO   018C
*
0008:  MOVWF  04
000A:  MOVFF  FD8,05
000E:  MOVFF  FE0,06
0012:  MOVLB  0
0014:  MOVFF  FE9,0C
0018:  MOVFF  FEA,07
001C:  MOVFF  FE1,08
0020:  MOVFF  FE2,09
0024:  MOVFF  FD9,0A
0028:  MOVFF  FDA,0B
002C:  MOVFF  FF3,12
0030:  MOVFF  FF4,13
0034:  MOVFF  FFA,14
0038:  MOVFF  FF5,15
003C:  MOVFF  FF6,16
0040:  MOVFF  FF7,17
0044:  MOVFF  00,0E
0048:  MOVFF  01,0F
004C:  MOVFF  02,10
0050:  MOVFF  03,11
0054:  BTFSS  F9D.5
0056:  GOTO   0060
005A:  BTFSC  F9E.5
005C:  GOTO   00AE
0060:  MOVFF  0E,00
0064:  MOVFF  0F,01
0068:  MOVFF  10,02
006C:  MOVFF  11,03
0070:  MOVFF  0C,FE9
0074:  MOVFF  07,FEA
0078:  BSF    07.7
007A:  MOVFF  08,FE1
007E:  MOVFF  09,FE2
0082:  MOVFF  0A,FD9
0086:  MOVFF  0B,FDA
008A:  MOVFF  12,FF3
008E:  MOVFF  13,FF4
0092:  MOVFF  14,FFA
0096:  MOVFF  15,FF5
009A:  MOVFF  16,FF6
009E:  MOVFF  17,FF7
00A2:  MOVF   04,W
00A4:  MOVFF  06,FE0
00A8:  MOVFF  05,FD8
00AC:  RETFIE 0
.................... /*  
....................  * File:   main.c 
....................  * Author: Miroslav 
....................  * 
....................  * Created on November 19, 2015, 11:22 PM 
....................  */ 
....................  
.................... #include "main.h" 
.................... /*  
....................  * File:   main.h 
....................  * Author: Miroslav 
....................  * 
....................  * Created on November 19, 2015, 11:22 PM 
....................  */ 
....................  
.................... #ifndef main_H 
.................... #define main_H 
....................  
.................... #include <18F4431.h> 
.................... //////////// Standard Header file for the PIC18F4431 device //////////////// 
.................... /////////////////////////////////////////////////////////////////////////// 
.................... ////        (C) Copyright 1996, 2014 Custom Computer Services          //// 
.................... //// This source code may only be used by licensed users of the CCS C  //// 
.................... //// compiler.  This source code may only be distributed to other      //// 
.................... //// licensed users of the CCS C compiler.  No other use, reproduction //// 
.................... //// or distribution is permitted without written permission.          //// 
.................... //// Derivative programs created using this software in object code    //// 
.................... //// form are not restricted in any way.                               //// 
.................... /////////////////////////////////////////////////////////////////////////// 
.................... #device PIC18F4431 
*
00E0:  DATA 0D,0A
00E2:  DATA 52,75
00E4:  DATA 6E,6E
00E6:  DATA 69,6E
00E8:  DATA 67,2E
00EA:  DATA 2E,2E
00EC:  DATA 0D,0A
00EE:  DATA 00,00
*
0148:  TBLRD*+
014A:  MOVF   FF5,F
014C:  BZ    0166
014E:  MOVFF  FF6,3D
0152:  MOVFF  FF7,3E
0156:  MOVFF  FF5,3F
015A:  RCALL  012C
015C:  MOVFF  3D,FF6
0160:  MOVFF  3E,FF7
0164:  BRA    0148
0166:  GOTO   0214 (RETURN)
....................  
.................... #list 
....................  
....................  
.................... #device     ADC = 10  
.................... #fuses      H4 
.................... #fuses      NOFCMEN 
.................... #fuses      NOIESO 
.................... #fuses      NOPUT 
.................... #fuses      NOBROWNOUT 
.................... #fuses      NOWDT 
.................... #fuses      NOWINEN 
.................... #fuses      NOPWMPIN 
.................... #fuses      HPOL_HIGH 
.................... #fuses      LPOL_HIGH 
.................... #fuses      T1LOWPOWER 
.................... #fuses      FLTAD4 
.................... #fuses      SSP_RC 
.................... #fuses      NOPWMPIN 
.................... #fuses      MCLR 
.................... #fuses      NOLVP 
.................... #fuses      NODEBUG 
....................  
.................... #define     RX_PIN      PIN_C7 
.................... #define     TX_PIN      PIN_C6 
.................... #define     RS485_RW    PIN_C0 
....................  
.................... #use delay(clock = 40MHZ) 
.................... #use rs232(xmit=TX_PIN, rcv=RX_PIN, enable=RS485_RW) 
*
012C:  BCF    F94.0
012E:  BSF    F8B.0
0130:  BTFSS  F9E.4
0132:  BRA    0130
0134:  BCF    F94.0
0136:  BSF    F8B.0
0138:  MOVFF  3F,FAD
013C:  NOP   
013E:  BTFSS  FAC.1
0140:  BRA    013E
0142:  BCF    F94.0
0144:  BCF    F8B.0
0146:  RETURN 0
....................   
.................... // UART Registers and bits 
.................... #byte TXSTA=0xFAC 
.................... #bit  BRGH=TXSTA.2 
.................... #bit  SYNC=TXSTA.4 
....................  
.................... #byte RCSTA=0xFAB 
.................... #bit  ADDEN=RCSTA.3 
.................... #bit  RX9=RCSTA.6 
....................  
.................... #byte BAUDCTL=0xFAA 
.................... #bit  BRG16=BAUDCTL.3 
....................  
.................... int16 SPBRG;  
.................... #locate SPBRG=0xFAF 
....................  
....................  
.................... #endif 
....................  
....................  
....................  
.................... #include "uart.h" 
.................... /*  
....................  * File:   uart.h 
....................  * Author: Miroslav 
....................  * 
....................  * Created on November 20, 2015, 12:17 AM 
....................  */ 
....................  
.................... #ifndef UART_H 
.................... #define	UART_H 
....................  
.................... void serial_isr(void); 
.................... BYTE uart_bgetc(void); 
.................... void uart_init(unsigned int, BYTE); 
....................  
.................... #endif	/* UART_H */ 
....................  
....................  
.................... #include "uart.c" 
.................... /* 
....................  * File:   uart.c 
....................  * Author: Miroslav 
....................  * 
....................  * Created on November 19, 2015, 11:22 PM 
....................  */ 
....................  
.................... #include "uart.h" 
.................... /*  
....................  * File:   uart.h 
....................  * Author: Miroslav 
....................  * 
....................  * Created on November 20, 2015, 12:17 AM 
....................  */ 
....................  
.................... #ifndef UART_H 
.................... #define	UART_H 
....................  
.................... void serial_isr(void); 
.................... BYTE uart_bgetc(void); 
.................... void uart_init(unsigned int, BYTE); 
....................  
.................... #endif	/* UART_H */ 
....................  
....................  
....................  
.................... //Defines 
.................... #define BUFFER_SIZE 32 
.................... #define uart_bkbhit (in.next_in!=in.next_out) 
.................... //Variables 
.................... typedef struct buffer 
.................... { 
....................     BYTE uart_buffer[BUFFER_SIZE]; 
....................     BYTE next_in; 
....................     BYTE next_out; 
.................... } t_buffer; 
....................  
.................... t_buffer in = {{0}, 0, 0}; 
....................  
.................... #int_rda 
.................... void serial_isr() 
.................... { 
....................     int t; 
....................      
....................     in.uart_buffer[in.next_in] = getc(); 
*
00AE:  CLRF   03
00B0:  MOVF   39,W
00B2:  ADDLW  19
00B4:  MOVWF  FE9
00B6:  MOVLW  00
00B8:  ADDWFC 03,W
00BA:  MOVWF  FEA
00BC:  BTFSS  F9E.5
00BE:  BRA    00BC
00C0:  MOVFF  FAE,FEF
....................     t = in.next_in; 
00C4:  MOVFF  39,41
....................     in.next_in = (in.next_in + 1) % BUFFER_SIZE; 
00C8:  MOVLW  01
00CA:  ADDWF  39,W
00CC:  ANDLW  1F
00CE:  MOVWF  39
....................     if (in.next_in == in.next_out) 
00D0:  MOVF   3A,W
00D2:  SUBWF  39,W
00D4:  BNZ   00DA
....................         in.next_in = t;                                // Buffer full 
00D6:  MOVFF  41,39
00DA:  BCF    F9E.5
00DC:  GOTO   0060
.................... } 
.................... /** 
....................  * uart_bgetc, Function return one byte from uart circular buffer 
....................  * @return , first buffer that is written to the buffer 
....................  */ 
.................... BYTE uart_bgetc() 
.................... { 
....................     BYTE c; 
....................      
....................     //while(!uart_bkbhit);                          // This should be checked 
....................                                                     // in parser before state 
....................                                                     //machine is called 
....................     c = in.uart_buffer[in.next_out]; 
*
016A:  CLRF   03
016C:  MOVF   3A,W
016E:  ADDLW  19
0170:  MOVWF  FE9
0172:  MOVLW  00
0174:  ADDWFC 03,W
0176:  MOVWF  FEA
0178:  MOVFF  FEF,3D
....................     in.next_out = (in.next_out + 1) % BUFFER_SIZE; 
017C:  MOVLW  01
017E:  ADDWF  3A,W
0180:  ANDLW  1F
0182:  MOVWF  3A
....................     return (c); 
0184:  MOVFF  3D,01
0188:  GOTO   021C (RETURN)
.................... } 
.................... /** 
....................  * uart_init, Function configure uart peripheral 
....................  * @param baudrate, Possible baudrates are: 1 - 19200, 2 - 115200, 3 - 256000 
....................  * @param dev_id, Device address used in RS485 communication 
....................  */ 
.................... void uart_init(unsigned int baudrate, BYTE dev_id) 
.................... { 
....................     unsigned long divisor; 
....................      
....................     switch (baudrate) 
*
00F0:  MOVF   3D,W
00F2:  XORLW  01
00F4:  BZ    0100
00F6:  XORLW  03
00F8:  BZ    010A
00FA:  XORLW  01
00FC:  BZ    0112
00FE:  BRA    0118
....................     { 
....................         case 1: 
....................             //setup_uart(19200); 
....................             divisor = 520; 
0100:  MOVLW  02
0102:  MOVWF  40
0104:  MOVLW  08
0106:  MOVWF  3F
....................             break; 
0108:  BRA    0118
....................         case 2: 
....................             //setup_uart(115200); 
....................             divisor = 85; 
010A:  CLRF   40
010C:  MOVLW  55
010E:  MOVWF  3F
....................             break; 
0110:  BRA    0118
....................         case 3: 
....................             //setup_uart(256000); 
....................             divisor = 38; 
0112:  CLRF   40
0114:  MOVLW  26
0116:  MOVWF  3F
....................             break; 
....................     } 
....................      
....................     // Switch to 16bit mode 
....................     SYNC = 0; 
0118:  BCF    FAC.4
....................     BRGH = 1; 
011A:  BSF    FAC.2
....................     BRG16 = 1; 
011C:  BSF    FAA.3
....................     // Select 9-bit reception 
....................     //RX9 = 0; 
....................     // Disable uart address detecion on receive 
....................     //ADDEN = 0; 
....................     // Configure uart speed 
....................     SPBRG = divisor; 
011E:  MOVFF  40,FB0
0122:  MOVFF  3F,FAF
....................     //setup_uart(UART_ADDRESS); 
....................     enable_interrupts(INT_RDA); 
0126:  BSF    F9D.5
0128:  GOTO   0206 (RETURN)
.................... } 
....................  
....................  
....................  
.................... void main() 
*
018C:  CLRF   FF8
018E:  BCF    FD0.7
0190:  BSF    07.7
0192:  BCF    F94.0
0194:  BCF    F8B.0
0196:  BSF    FAA.3
0198:  MOVLW  11
019A:  MOVWF  FAF
019C:  MOVLW  04
019E:  MOVWF  FB0
01A0:  MOVLW  A6
01A2:  MOVWF  FAC
01A4:  MOVLW  90
01A6:  MOVWF  FAB
01A8:  CLRF   3C
01AA:  CLRF   3B
01AC:  BCF    FB9.0
01AE:  BCF    FC1.6
01B0:  BCF    FC1.7
01B2:  MOVLW  00
01B4:  MOVWF  FB8
01B6:  BRA    01BE
01B8:  DATA 22,40
01BA:  DATA 19,00
01BC:  DATA 00,00
01BE:  MOVLW  00
01C0:  MOVWF  FF8
01C2:  MOVLW  01
01C4:  MOVWF  FF7
01C6:  MOVLW  B8
01C8:  MOVWF  FF6
01CA:  TBLRD*+
01CC:  MOVF   FF5,W
01CE:  MOVWF  00
01D0:  XORLW  00
01D2:  BZ    01FA
01D4:  TBLRD*+
01D6:  MOVF   FF5,W
01D8:  MOVWF  01
01DA:  BTFSC  FE8.7
01DC:  BRA    01E8
01DE:  ANDLW  0F
01E0:  MOVWF  FEA
01E2:  TBLRD*+
01E4:  MOVFF  FF5,FE9
01E8:  BTFSC  01.6
01EA:  TBLRD*+
01EC:  BTFSS  01.6
01EE:  TBLRD*+
01F0:  MOVFF  FF5,FEE
01F4:  DCFSNZ 00,F
01F6:  BRA    01CA
01F8:  BRA    01EC
01FA:  CLRF   FF8
.................... { 
....................     uart_init(2, 120);  
01FC:  MOVLW  02
01FE:  MOVWF  3D
0200:  MOVLW  78
0202:  MOVWF  3E
0204:  BRA    00F0
....................     enable_interrupts(GLOBAL); 
0206:  MOVLW  C0
0208:  IORWF  FF2,F
....................      
....................     printf("\r\n\Running...\r\n"); 
020A:  MOVLW  E0
020C:  MOVWF  FF6
020E:  MOVLW  00
0210:  MOVWF  FF7
0212:  BRA    0148
....................      
....................     while (1) 
....................     { 
....................         //delay_ms(5000); 
....................         //printf("\r\nBuffered data => \r\n"); 
....................         while (uart_bkbhit) 
0214:  MOVF   3A,W
0216:  SUBWF  39,W
0218:  BZ    0228
....................             putc(uart_bgetc()); 
021A:  BRA    016A
021C:  MOVFF  01,3D
0220:  MOVFF  01,3F
0224:  RCALL  012C
0226:  BRA    0214
0228:  BRA    0214
....................     } 
.................... } 
....................  
022A:  BRA    022A

Configuration Fuses:
   Word  1: 0600   H4 NOFCMEN NOIESO
   Word  2: 3E0D   NOPUT NOBROWNOUT BORV20 NOWDT WDT32768 NOWINEN
   Word  3: 9C3C   NOPWMPIN LPOL_HIGH HPOL_HIGH T1LOWPOWER FLTAD4 SSP_RC PWM4B5 EXCLKC3 MCLR
   Word  4: 0001   STVREN NOLVP DEBUG
   Word  5: C00F   NOPROTECT NOCPB NOCPD
   Word  6: E00F   NOWRT NOWRTC NOWRTB NOWRTD
   Word  7: 400F   NOEBTR NOEBTRB

   Some fuses have been forced to be compatible with the ICD debugger.
